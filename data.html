<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>صفحة البيانات</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      vertical-align: middle;
      white-space: nowrap;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    .delete-btn {
      background-color: #dc3545;
    }
    .delete-btn:hover {
      background-color: #a71d2a;
    }
  </style>
</head>
<body>

  <h1>صفحة البيانات</h1>

  <table id="dataTable">
    <thead>
      <tr>
        <th>تاريخ البدء</th>
        <th>المدة المستمرة (بالثواني)</th>
        <th>تاريخ التوقف</th>
        <th>المدة النهائية (بالثواني)</th>
        <th>الحذف</th>
      </tr>
    </thead>
    <tbody>
      <!-- سيبدأ الصف الأول تلقائياً -->
    </tbody>
  </table>

  <script>
    // صيغة عرض التاريخ والوقت: YYYY-MM-DD HH:MM:SS
    function formatDateTime(date) {
      return date.getFullYear() + '-' +
        String(date.getMonth()+1).padStart(2,'0') + '-' +
        String(date.getDate()).padStart(2,'0') + ' ' +
        String(date.getHours()).padStart(2,'0') + ':' +
        String(date.getMinutes()).padStart(2,'0') + ':' +
        String(date.getSeconds()).padStart(2,'0');
    }

    // تخزين عداد المدة لكل صف
    let intervalId = null;
    let startTime = null;

    // إنشاء صف جديد
    // مع خيار: هل هو الصف الأول (يحتوي زر بدء) أم صف لاحق (يحتوي نص فقط)
    function createRow(isFirstRow = false, startDateText = '', duration = 0, stopDateText = '', finalDuration = 0) {
      const tbody = document.getElementById('dataTable').querySelector('tbody');
      const tr = document.createElement('tr');

      if (isFirstRow) {
        // الصف الأول يحتوي زر "تاريخ البداية"
        tr.innerHTML = `
          <td><button class="start-btn">تاريخ البداية</button><br><span class="start-time">${startDateText}</span></td>
          <td><span class="duration">${duration}</span></td>
          <td><button class="stop-btn" disabled>تم الكسر</button><br><span class="stop-time">${stopDateText}</span></td>
          <td><span class="final-duration">${finalDuration}</span></td>
          <td><button class="delete-btn">حذف</button></td>
        `;

        tbody.appendChild(tr);

        const startBtn = tr.querySelector('.start-btn');
        const stopBtn = tr.querySelector('.stop-btn');
        const deleteBtn = tr.querySelector('.delete-btn');

        startBtn.addEventListener('click', () => {
          if (startTime) return; // لا نعيد البدء
          startTime = new Date();
          tr.querySelector('.start-time').textContent = formatDateTime(startTime);
          startBtn.disabled = true;
          stopBtn.disabled = false;

          // بدء عداد المدة المستمرة
          intervalId = setInterval(() => {
            const now = new Date();
            const secondsPassed = Math.floor((now - startTime) / 1000);
            tr.querySelector('.duration').textContent = secondsPassed;
          }, 1000);
        });

        stopBtn.addEventListener('click', () => {
          if (!startTime) return;
          const stopTime = new Date();
          tr.querySelector('.stop-time').textContent = formatDateTime(stopTime);
          stopBtn.disabled = true;

          // إيقاف العداد
          clearInterval(intervalId);

          // حساب المدة النهائية
          const finalDur = Math.floor((stopTime - startTime) / 1000);
          tr.querySelector('.final-duration').textContent = finalDur;

          // إنشاء صف جديد (بدون زر بدء)
          createRow(false);
        });

        deleteBtn.addEventListener('click', () => {
          clearInterval(intervalId);
          tr.remove();

          // إذا حذفنا الصف الأول (زر البداية) ونصفه لم يبدأ، نعيد إنشاء صف أول جديد
          if (isFirstRow) {
            startTime = null;
            intervalId = null;
            createRow(true);
          }
        });

      } else {
        // صف لاحق بدون زر بدء، فقط عرض بيانات (في البداية فارغ)
        tr.innerHTML = `
          <td><span class="start-time">${startDateText}</span></td>
          <td><span class="duration">${duration}</span></td>
          <td><span class="stop-time">${stopDateText}</span></td>
          <td><span class="final-duration">${finalDuration}</span></td>
          <td><button class="delete-btn">حذف</button></td>
        `;
        tbody.appendChild(tr);

        const deleteBtn = tr.querySelector('.delete-btn');
        deleteBtn.addEventListener('click', () => {
          tr.remove();
        });
      }
    }

    // بدء التطبيق: إنشاء الصف الأول فقط
    createRow(true);
  </script>

</body>
</html>
